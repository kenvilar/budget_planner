<!DOCTYPE html>


<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        
        <!-- <link rel="stylesheet" type="text/css" href="jquery.mobile-1.4.1.min.css">
		<script type="text/javascript" src="jquery.mobile-1.4.1.min.js"></script>
		<script type="text/javascript" src="jquery-2.1.0.min.js"></script> -->

		<link rel="stylesheet" type="text/css" href="jquery.mobile-1.4.1/jquery.mobile-1.4.1.min.css">
		<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
		<script type="text/javascript" src="jquery.mobile-1.4.1/jquery.mobile-1.4.1.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="cordova.js"></script>
		<script type="text/javascript" charset="utf-8">	

			$(document).ready(function () {
				$('#txMoney').keyup(function () {
					$('#txTarget').val($('#txMoney').val()/2);
					$('#txTarget').attr('max',$('#txMoney').val());
				});
			});

			var db;
			var shortName = 'BudgetDB';
			var version = '1.0';
			var displayName = 'BudgetDB';
			var maxSize = 200;

			function errorHandler(transaction, error) {
   				alert('Error: ' + error.message + ' code: ' + error.code);
				}

			function successCallBack() {
   				alert("DEBUGGING: success");
 				}

			function nullHandler(){};

			function onBodyLoad(){
 				//alert("DEBUGGING: we are in the onBodyLoad() function");
 				if (!window.openDatabase) {
   					alert('Databases are not supported in this browser.');
   				return;
 				}
 
 				db = openDatabase(shortName, version, displayName,maxSize);
 	 			db.transaction(function(tx){

 				// Kung ganahan ta ug create-drop na db
  				//tx.executeSql( 'DROP TABLE BudgetDB',nullHandler,nullHandler);


 				tx.executeSql( 'CREATE TABLE IF NOT EXISTS BudgetDB(BudgetId INTEGER NOT NULL PRIMARY KEY, Name TEXT NOT NULL, Money INTEGER NOT NULL, Target INTEGER NOT NULL, Date DATE NOT NULL)', [],nullHandler,errorHandler);},errorHandler,nullHandler);
				
				db.transaction(function(tx){

 				tx.executeSql( 'CREATE TABLE IF NOT EXISTS Expense(ExpenseId INTEGER NOT NULL PRIMARY KEY, Description TEXT NOT NULL, Amount INTEGER NOT NULL, Category TEXT NOT NULL, Occurence INTEGER NOT NULL, Date DATE NOT NULL, Budget INTEGER)', [],nullHandler,errorHandler);},errorHandler,nullHandler);
				

 				ListDBValues();
 				GetName();
 				GetTarget();
			}

			function ListDBValues() {
 				if (!window.openDatabase) {
  					alert('Databases are not supported in this browser.');
  				return;
 				}
 
 				html = '';
 				$('#Budgets').html('');
 
				db.transaction(function(transaction) {
   					transaction.executeSql('SELECT * FROM BudgetDB;', [],
     					function(transaction, result) {
      					if (result != null && result.rows != null) {
      						html = html + '<ul data-role="listview">';
        					for (var i = 0; i < result.rows.length; i++) {
          						var row = result.rows.item(i);
          					
    					        html += '<li>';
    					        html += '<a href="#editBudget" onClick=GetName(' + row.BudgetId +') class="ui-btn ui-corner-all ui-shadow">'+row.Name+ ' , ' + row.Target + '</a>';
    					        html += '</li>';
        						}
        					html += '</ul>';
        					$('#Budgets').append(html);
      						}
     					},errorHandler);
 					},errorHandler,nullHandler);
 
 					return;
 

			}



			function clearAddBudgetField() {
				$('#txTarget').val('');
				$('#txName').val('');
				$('#txMoney').val('');

				return;
			}

			function AddValueToDB() {
				if (!window.openDatabase) {
					alert('Databases are not supported in this browser.');
					return;
				}

				db.transaction(function(transaction) {
					transaction.executeSql(
							'INSERT INTO BudgetDB(Name, Money, Target, Date) VALUES (?,?,?,?)',
							[ $('#txName').val(), $('#txMoney').val(), $('#txTarget').val(), $('#txDateCreated').val()],
							nullHandler, errorHandler);
				});

				ListDBValues();
				GetName();
				GetTarget();
				return false;
			}


			function AddExpense() {
				if (!window.openDatabase) {
					alert('Databases are not supported in this browser.');
					return;
				}

				db.transaction(function(transaction) {
					transaction.executeSql('INSERT INTO Expense(Description, Amount, Category, Occurence, Date, Budget) VALUES (?,?,?,?,?,?)', [ $('#txDescription').val(), $('#txAmount').val(), $('#txCategory').val(), $('#txOccurence').val(), $('#txDate').val(), $('#currentBudgetID').val()], nullHandler, errorHandler);
				});

								
				return false;
			}
			
			function GetName(id) {
				$('#currentBudgetID').val(id);
 				if (!window.openDatabase) {
  					alert('Databases are not supported in this browser.');
  				return;
 				}
 
 				$('#MyTarget').html('');
 				$('#MyName').html('');
 				$('#MyMoney').html('');
 
				db.transaction(function(transaction) {
   					transaction.executeSql('SELECT * FROM BudgetDB WHERE BudgetId = ?;', [id],
     					function(transaction, result) {
      					if (result != null && result.rows != null) {
        					for (var i = 0; i < result.rows.length; i++) {
          						var row = result.rows.item(i);
          						$('#MyName').append(row.Name);
          						$('#MyMoney').append(row.Money);
          						$('#MyTarget').append(row.Target);
          						$('#Myid').append(row.BudgetId);
          						$('#Myid').val(row.BudgetId);
        						}
      						}
     					},errorHandler);
 					},errorHandler,nullHandler);
 
 					return;
 

			}

			function DeleteBudget() {
				var id = $('#Myid').val();
				if (!window.openDatabase) {
					alert('Databases are not supported in this browser.');
					return;
				}

				if(confirm("Are you sure you want to delete?")) {
					db.transaction(function(transaction) {
						transaction.executeSql(
								'DELETE FROM BudgetDB WHERE BudgetId = ?;',
								[id],
								nullHandler, errorHandler);
					});
				}

				ListDBValues();
				GetName();
				GetTarget();
				return false;
			}

			function updateBudget(){
				var id = $('#Myid').val();
				db.transaction(
				    function (transaction) {
				    	if( ($('#bdgtnm').val() != '') && ($('#trgt').val() != '') ) {
				    		var bdgtnm = $('#bdgtnm').val();
				    		var trgt = $('#trgt').val();
				    	} else {
				    		var bdgtnm = 'none';
				    		var trgt = 'none';
				    	}
					

				    	transaction.executeSql('UPDATE BudgetDB SET Name=?, Target=? WHERE BudgetId = ?;', [bdgtnm, trgt, id]);
				    }
				);
				ListDBValues();
				GetName(id);
				GetTarget();
				return false;
			}

		</script>


        <title>Budget Planner</title>
    </head>

    <body onload="onBodyLoad()">
    
    	<div id="fb-root"></div>
		<script>
			(function(d, s, id) {
			  var js, fjs = d.getElementsByTagName(s)[0];
			  if (d.getElementById(id)) return;
			  js = d.createElement(s); js.id = id;
			  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=170509146458314";
			  fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
    
   		<div data-role="page" id="mainpage" onload="onBodyLoad()">
   		
			<div data-role="header">
    			<h1>Home</h1>
  			</div>

			<div data-role="content">
  				<a href="#addBudget" data-role="button" onClick="clearAddBudgetField()">Add Budget</a>
  				<div data-role="collapsible" data-collapsed="true" data-theme="b" data-content-theme="b">
					<h2>View Budget List</h2>
						<input type="hidden" id="currentBudgetID">
						<div id="Budgets"></div>
					
				</div>
  			</div>
		</div>

		<div data-role="page" id="addBudget" >
			<div data-role="header">
				<h1>Add Budget</h1>
			</div>
			<div data-role="content">
				<p>This is where you will add a new budget</p>
				<input type="text" placeholder="Budget name" id="txName">
				<input type="text" placeholder="Income" id="txMoney">
				<label for="Target">Target Savings:</label>
				<input type="range" id="txTarget" min="0">
				<script>
					document.write('<input type="hidden" id="txDateCreated" value="'+ new Date() +'">');
				</script>
				<a href="#mainpage" class="ui-btn" onClick="AddValueToDB()">Add Budget</a>
				<br>
				<a href="#mainpage" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-back ui-btn-b">Back</a>

			</div>
		</div>

		<div data-role="page" id="addExpensePage" >
			<div data-role="header">
				<a href="#mainpage" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all ui-btn-icon-left ui-icon-home">Home</a>
				<h1>Add Expense</h1>
			</div>
			<div data-role="content">
				<p>This is where you will add a new expense</p>
				<fieldset class="ui-field-contain">
    					<label for="category">Select Category</label>
    					<select name="category" id="txCategory">
      						<option value="Food">Food / Beverages</option>
      						<option value="Transportation">Transportation</option>
      						<option value="Education">Education</option>
							<option value="Clothing">Clothing</option>
							<option value="Personal">Personal</option>
							<option value="Home">Home</option>
							<option value="Other">Other</option>
    					</select>
  				</fieldset>
				<input type="text" placeholder="Description" id="txDescription">
				<input type="text" placeholder="Amount" id="txAmount">
				<input type="text" placeholder="Number of Occurence per month" id="txOccurence">
				<script>
					document.write('<input type="hidden" id="txDate" value="'+ new Date() +'">');
				</script>				
								
				
				<a href="#editBudget" class="ui-btn" onClick="AddExpense()">Add Expense</a>
				<br>
				
				<a href="#editBudget" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-back ui-btn-b">Back</a>
				
			</div>
		</div>
		
		<div data-role="page" id="editBudget" onload="onBodyLoad()">
			<div data-role="header">
				<h1>Edit Budget</h1>
			</div>
			<div data-role="content">
				<div class="fb-share-button" data-href="https://www.facebook.com/" data-type="button"></div><br>
				<b>Budget Name: <small id="MyName"></small></b><br>
				<b>Budget Money: ₱<small id="MyMoney"></small></b><br>
				<b>Target: ₱<small id="MyTarget"></small></b>
				<br>
				<br>
				<script>
					document.write('<h3>Remaining Daily Budget: </h3>');
					document.write('<br>');
					document.write('<h3>Remaining Monthly Budget: </h3>');
				</script>
				<a href="#addExpensePage" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-delete ui-btn-b" ">Add Expense</a>
				<br>
				<a href="#mainpage" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-back ui-btn-b">Back</a>

			</div>
			<div data-role="footer" data-theme="b" data-position="fixed" style="text-align:center;">
				<a href="#popupedit" data-rel="popup" data-position-to="window" class="ui-btn ui-corner-all ui-shadow ui-icon-edit ui-btn-icon-left ui-btn-b" data-transition="pop">Edit Budget</a>
				<div data-role="popup" id="popupedit" data-theme="a" class="ui-corner-all">
				    <form>
				        <div style="padding:10px 20px;">
				            <h3>Edit your budget</h3>
				            <input type="hidden" id = "Myid" for="Myid"></input>
				            <label for="bdgtnm" class="ui-hidden-accessible">Budget Name:</label>
				            <input type="text" name="budget_name" id="bdgtnm" value="" placeholder="budget name" data-theme="a">
				            <label for="trgt" class="ui-hidden-accessible">Target:</label>
				            <input type="number" name="budget_target" pattern="[0-9]*" id="trgt" value="" data-theme="a" placeholder="target">
				            <a href="#editBudget" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-btn-b ui-icon-edit" onClick="updateBudget()">Update</a>
							<a href="#editBudget" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-btn-b ui-icon-arrow-l">Cancel</a>
				        </div>
				    </form>
				</div>
				<a href="#mainpage" class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-delete ui-btn-b" onClick="DeleteBudget()">Delete Budget</a>
				<!-- <a href="http://developers.facebook.com/docs/plugins/" class="fb-share-button ui-btn ui-btn-b"></a> -->
			</div>
		</div>

   
    </body>
</html>
